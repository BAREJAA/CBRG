---
title: "Handling Strings in R (Answers)"
author: "Your name"
date: "Apr 05, 2022"

output:
  html_document: 
    
    toc: true 
    toc_float: 
      collapsed: false 
      smooth_scroll: false 
      
    number_sections: true 
    
    theme: paper 
    
    output: 
      fig_width: 10 
      fig_height: 8 
      fig_caption: true 
      dev: svg 
    
    #Dataframe printing
    df_print: paged 
    
    code_folding: show 
  
  pdf_document: default
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)

cran_pkgs <- c(
  "remotes",
  "tidyverse"
  )

# Install and load CRAN packages
installifnot <- function(pckgName){
    if (!(require(pckgName, character.only = TRUE))) {
        install.packages(pckgName, dep = TRUE)
        library(pckgName, character.only = TRUE)
    }
}

lapply(cran_pkgs, installifnot)

remotes::install_github("matthewhirschey/tidybiology", force = TRUE)
library(tidybiology)
data(proteins)
```

# Definition and useful references

A "string" in R is anything within quotation marks e.g. "I am a string"

Much of this walkthrough is modeled on the "Strings" of Hadley Wickham's R4DS book - 
https://r4ds.had.co.nz/strings.html

We will mostly be making use of the {stringr} package for this walkthrough. Useful documentation and examples can be found here - https://stringr.tidyverse.org

And here's a handy cheatsheet that describes how the functions in this package work - 
https://evoldyn.gitlab.io/evomics-2018/ref-sheets/R_strings.pdf

# Simple string handling

```{r}
string <- "MSMLVVFLLLWGVTWGPVTEAAIFYETQPSL"

# How many amino acids are in this sequence?
length(string)
str_length(string)
# Why do these functions give different answers?
?str_length

# How many lysines does this sequence contain?
str_count(string, "L")
str_view_all(string, "L")

# How many times do two consecutive Alanines occur in this sequence?
str_count(string, "AA")
str_view_all(string, "AA")

# Does this sequence contain a Proline followed by a Valine followed by a Threonine?
str_detect(string, "PVT")
str_view_all(string, "PVT")

# Does this sequence contain a Tryptophan, followed by ANY amino acid, and then a Valine?
str_detect(string, "W.V")
str_view_all(string, "W.V")
```

# Handling strings in Data frames

```{r}
# Take a look at the `proteins` df
View(proteins)

# How would you create a new dataframe that only contains proteins that contain the "RCP.L" motif?
proteins %>% 
  filter(str_detect(sequence, "RCP.L"))

# Identify proteins that contain the E-box motif - "CANNTG". Create a new column called `e_box` that contains a `TRUE` if a sequence has this motif and a `FALSE` otherwise
proteins %>% 
  mutate(e_box = str_detect(sequence, "CA..TG")) %>% 
  relocate(e_box) # this moves the named column to the start of the data frame

# What are the mean protein lengths for proteins that contain an E-box versus proteins that do not?
proteins %>% 
  mutate(e_box = str_detect(sequence, "CA..TG")) %>% 
  group_by(e_box) %>% 
  summarise(mean_length = mean(length))
```

# Regular expressions
```{r}
# Build two small data frames for these examples
protein_small <- tibble(
gene_names = c("A1BG_HUMAN", "A1CF_HUMAN", "B3GAT1_HUMAN"),
uniprot_id = c("P04217", "Q9NQ94", "Q9P2W7")
)

my_expt <- tibble(
  value = runif(6),
  sample = c("control1", "Control2", "cONtrol3", "treated1", "Treated2", "TREATed3")
)

# Use `protein_small` df for the following examples -
# Only keep proteins whose name begins with an "A"
protein_small %>% 
  filter(str_detect(gene_names, "A")) # doesn't work
protein_small %>% 
  filter(str_detect(gene_names, "^A"))

str_view_all(gene_small$protein_names, "A")
str_view_all(gene_small$protein_names, "^A")

# Remove "_HUMAN" from protein names from the `protein_small` data frame
protein_small <- protein_small %>% 
                  mutate(protein_names = str_replace(protein_names, "_HUMAN", ""))

# Use `my_expt` df for the following examples -
# Convert all sample entries to lower case
my_expt <- my_expt %>% 
            mutate(sample = str_to_lower(sample))

# Create a new column called "condition" that contains the sample entries with the numbers removed
my_expt <- my_expt %>% 
            mutate(condition = str_remove(sample, "[:digit:]"))
```

# Advanced Regex
```{r}
# REMOVE EXTRA INFO FROM GENES
gene_names <- c("A1BG (1)", "A1CF (29974)", "A2M (2)", "A2ML1 (144568)", "A3GALT2 (127550)", "A4GALT (53947)", "A4GNT (51146)", "AAAS (8086)", "AACS (65985)")

gene_names %>%
  stringr::str_replace("\\s*\\([^\\)]+\\)", "")

# also
gene_names %>% 
  stringr::str_remove("\\s.*")

# also
word(gene_names)
```

